Raycast from A to B.

Cast from A to B, check for hits.

If the distance from HP to B is less than the distance from BP to B, set BP to HP.

Perform collision check from BP to B.

The EP (exit position) should be on the other side of the collision object. When finished set BP (bullet position) to the EP.